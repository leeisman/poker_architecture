
## Golang Interface å®Œæ•´ç­†è¨˜

### âœ… Interface æ˜¯ä»€éº¼ï¼Ÿ
- æ˜¯ä¸€çµ„æ–¹æ³•çš„é›†åˆï¼šä»»ä½•å¯¦ä½œäº† interface æ‰€æœ‰æ–¹æ³•çš„å‹åˆ¥ï¼Œéƒ½è¢«è¦–ç‚ºã€Œå¯¦ä½œäº†é€™å€‹ interfaceã€
- åœ¨ Go ä¸­å±¬æ–¼ã€Œéš±å¼å¯¦ä½œã€ï¼ˆImplicit implementationï¼‰ï¼Œ**ä¸ç”¨æ˜ç¢ºå®£å‘Š implements**

```go
type Reader interface {
    Read(p []byte) (n int, err error)
}
```

---

### âœ… Interface çš„æ‡‰ç”¨å ´æ™¯
1. **æŠ½è±¡è¨­è¨ˆ / è§£è€¦ä¾è³´**
   - å¦‚ï¼š`io.Reader`, `http.Handler`
2. **å–®å…ƒæ¸¬è©¦ mock**
   - ç”¨ interface æ›¿æ›å¯¦é«”ï¼Œæ–¹ä¾¿ mock ä¾è³´è¡Œç‚º
3. **ç­–ç•¥æ¨¡å¼ / æ’æ‹”å¼å¯¦ä½œ**
   - å¯æ ¹æ“šä¸åŒç’°å¢ƒå‚³å…¥ä¸åŒå¯¦ä½œ

---

### âœ… å¯¦ä½œè¦å‰‡ï¼ˆéš±å¼ï¼‰

```go
type Animal interface {
    Speak() string
}

type Dog struct{}
func (d Dog) Speak() string {
    return "Woof"
}

var a Animal = Dog{} // âœ… OKï¼šDog æœ‰å¯¦ä½œ Speak()
```

---

### âš ï¸ å€¼èˆ‡æŒ‡æ¨™å¯¦ä½œå·®ç•°
- å¦‚æœ interface å®šç¾©çš„æ–¹æ³•æ˜¯é€é **æŒ‡æ¨™æ¥æ”¶è€…** å¯¦ä½œï¼Œå‰‡åªæœ‰ `*T` èƒ½æ»¿è¶³ interface

```go
type Doer interface {
    Do()
}

type Worker struct{}
func (w *Worker) Do() {} // åªæœ‰ *Worker å¯¦ä½œäº† Doer

var d Doer = &Worker{} // âœ… OK
var d2 Doer = Worker{}  // âŒ ç·¨è­¯éŒ¯èª¤
```

---

### âœ… ç©ºä»‹é¢ï¼ˆinterface{}ï¼‰
- å¯æ¥å—ä»»æ„å‹åˆ¥ï¼ˆç­‰åŒæ–¼ Java çš„ Objectï¼‰
- å¯¦å‹™æ‡‰ç”¨ï¼šJSON è§£æã€æ³›å‹åƒæ•¸ã€map[string]interface{}

```go
func PrintAny(val interface{}) {
    fmt.Println(val)
}
```

---

### ğŸ§  Interface å…§éƒ¨åŸç†ç°¡è¿°
| åç¨± | èªªæ˜ |
|------|------|
| itab | method tableï¼Œè¨˜éŒ„å‹åˆ¥å°æ‡‰çš„ method å¯¦ä½œ |
| data | æŒ‡å‘å¯¦éš›å„²å­˜çš„å€¼ï¼ˆå€¼æˆ–æŒ‡æ¨™ï¼‰ |

ç•¶ä½ å¯« `var r io.Reader = file`ï¼Œå…¶å¯¦æ˜¯å‰µå»ºäº†ä¸€å€‹ `interface{itab, data}` çµæ§‹ï¼Œé€é itab åŸ·è¡Œå°æ‡‰æ–¹æ³•ã€‚

---

### ğŸ“Œ å¸¸è¦‹é¢è©¦é¡Œèˆ‡å›ç­”

**1. interface ç‚ºä»€éº¼æ˜¯éš±å¼å¯¦ä½œï¼Ÿå„ªé»æ˜¯ä»€éº¼ï¼Ÿ**  
ç­”ï¼šé€™è®“ interface çš„ä½¿ç”¨æ›´éˆæ´»ï¼Œè§£è€¦æ€§é«˜ï¼Œä½¿ç”¨è€…ä¸éœ€ä¾µå…¥å¼ä¿®æ”¹å‹åˆ¥ã€‚åªè¦æ–¹æ³•å°å¾—ä¸Šï¼Œå°±èƒ½è‡ªå‹•è¢«èªå®šç‚ºå¯¦ä½œ interfaceï¼Œæå‡æ¨¡çµ„åŒ–èˆ‡å¯æ¸¬è©¦æ€§ã€‚

**2. ç‚ºä»€éº¼ç©ºä»‹é¢èƒ½æ¥å—æ‰€æœ‰å‹åˆ¥ï¼Ÿ**  
ç­”ï¼šå› ç‚ºåœ¨ Go ä¸­ï¼Œæ‰€æœ‰å‹åˆ¥éƒ½éš±å¼å¯¦ä½œäº†ç©º interfaceï¼ˆinterface{} æ²’æœ‰æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä»»ä½•æ±è¥¿éƒ½å¯ä»¥ç•¶æˆ interface{} å‚³éã€‚

**3. interface å¦‚ä½•èˆ‡å€¼/æŒ‡æ¨™æ¥æ”¶è€…äº’å‹•ï¼Ÿæœ‰ä½•é™åˆ¶ï¼Ÿ**  
ç­”ï¼šå¦‚æœä½ ç”¨æŒ‡æ¨™æ¥æ”¶è€…å¯¦ä½œ interface æ–¹æ³•ï¼Œåªæœ‰æŒ‡æ¨™å‹åˆ¥èƒ½è¢«è³¦å€¼çµ¦ interfaceã€‚è‹¥ç”¨å€¼æ¥æ”¶è€…å¯¦ä½œï¼Œå‰‡å€¼èˆ‡æŒ‡æ¨™éƒ½å¯ä»¥è¢«è³¦å€¼ã€‚

**4. interface æ˜¯å¦å¯ä»¥ç‚º nilï¼Ÿè¦æ³¨æ„ä»€éº¼é™·é˜±ï¼Ÿ**  
ç­”ï¼šå¯ä»¥ï¼Œä½†è¦å°å¿ƒ `interface != nil` ä¸¦ä¸ä»£è¡¨è£¡é¢æ²’åŒ… nilã€‚`interface{itab, data}` çš„ itab ä¸ç‚º nil æ™‚ï¼Œæ•´å€‹ interface != nilï¼Œå³ä½¿ data æ˜¯ nilã€‚

---

### â— interface == nil é™·é˜±
```go
var r io.Reader = (*os.File)(nil)
fmt.Println(r == nil) // falseï¼
```

- å› ç‚º `r` åŒ…å«äº† itabï¼ˆé nilï¼‰å’Œ dataï¼ˆæ˜¯ nilï¼‰
- æ‰€ä»¥ `interface != nil` æˆç«‹ï¼Œå³ä½¿è£¡é¢åŒ…çš„æ˜¯ nil
- æ­£ç¢ºåšæ³•ï¼š`if r == nil || reflect.ValueOf(r).IsNil() { ... }`

---

### âœ… ç¸½çµï¼šé¢è©¦é‡é»å¿ƒæ³•
| ä¸»é¡Œ | é‡é»èªªæ˜ |
|------|----------|
| éš±å¼å¯¦ä½œ | ä¸éœ€ implementsï¼Œé æ–¹æ³•ç°½åæ¯”å° |
| æŒ‡æ¨™ vs å€¼ | è‹¥ interface éœ€æ±‚çš„æ–¹æ³•æ˜¯æŒ‡æ¨™æ¥æ”¶è€…ï¼Œå¿…é ˆç”¨ *T ä¾†å¯¦ä½œ |
| ç©ºä»‹é¢ | ç”¨æ–¼æ³›å‹ã€JSONã€å¤šå‹åŒ…è£ |
| nil é™·é˜± | interface æœ¬èº«ä¸ç‚º nil ä½†å…§éƒ¨ data å¯èƒ½ç‚º nilï¼Œéœ€å°å¿ƒåˆ¤æ–· |

---

æŒæ¡ interface çš„æœ¬è³ªèˆ‡é™åˆ¶ï¼Œæ˜¯ Go é«˜éšå·¥ç¨‹å¸«éå¸¸é‡è¦çš„ä¸€ç’°ã€‚å»ºè­°å¯¦éš›å¯« mockã€æŠ½è±¡å±¤è¨­è¨ˆã€æ³›å‹åŒ…è£ç­‰æ‡‰ç”¨ä¾†åŠ æ·±ç†è§£ã€‚
