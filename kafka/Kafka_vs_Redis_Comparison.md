# 🔄 Kafka vs Redis：使用情境與架構比較

當設計分散式系統時，Apache Kafka 與 Redis 都是常見的選項，但兩者設計哲學、用途與架構特性大不相同。本比較將協助你快速理解它們的適合場景與關鍵差異。

---

## 📦 基本定位

| 項目           | Kafka                                | Redis                                |
|----------------|--------------------------------------|--------------------------------------|
| 類型           | 分散式日誌系統 / 訊息佇列             | Key-Value 快取 / 訊息中介軟體         |
| 主要用途       | 非同步通訊、事件流處理、資料串流       | 快取、即時查詢、簡易 Pub/Sub         |
| 儲存機制       | 持久化日誌（磁碟為主）                | 記憶體為主（可選持久化）             |
| 傳遞保證       | 至少一次 / 精確一次（設定）           | 最多一次（原生 Pub/Sub）             |

---

## 🧠 核心特性比較

| 特性                     | Kafka                                  | Redis                                  |
|--------------------------|-----------------------------------------|-----------------------------------------|
| 儲存                     | 高持久性、磁碟儲存                        | 以記憶體為主（RDB / AOF 持久化為輔）     |
| 傳遞語意（Delivery Semantics）| At least once / Exactly once         | At most once（Pub/Sub）                 |
| 消費模式                 | Consumer Group，支援水平擴展              | Pub/Sub 或 Stream，較為簡易              |
| 訊息順序                 | 每個 Partition 保證順序                   | 不保證順序（除非特別設計）              |
| 歷史資料查詢             | 可重播歷史資料（retention 設定）           | 一旦送出即消失（除非用 Stream）         |
| 水平擴展性               | 內建支援，透過 Partition 與 Broker 分攤    | Cluster 模式實作 sharding                |
| 高可用性                 | 多 Broker + Replica，ISR 選舉保護           | Sentinel / Cluster 模式提供高可用         |
| 資料一致性               | 需設定 ACK 與 min.insync.replicas 控制     | Master-Replica 複寫，可能有最終一致性延遲 |

---

## 🔧 適合使用場景

### ✅ Kafka 適用場景

- 微服務之間的非同步溝通
- 高併發寫入的大數據事件蒐集（如 clickstream、IoT）
- 可重播的訂閱系統（如訂單處理、支付流）
- 異步處理（如背景任務、事件驅動）

### ✅ Redis 適用場景

- API 快取層
- 頻率限制（Rate limiting）
- 分布式鎖（SETNX + EX）
- 即時計數器、排行榜（ZSet）
- 任務排程或 Pub/Sub 小規模應用
- 分散式 Session 儲存

---

## 🚫 使用時注意

| 問題                   | Kafka                                       | Redis                                     |
|------------------------|----------------------------------------------|-------------------------------------------|
| 延遲                   | 訊息傳遞延遲通常 > 5ms，非即時查詢用         | 毫秒等級延遲，適合即時查詢                 |
| 設定與維運成本         | 高：需設計 Partition、Broker、ISR、ACK 等     | 低：簡易部署，但 Cluster 模式略複雜         |
| 高一致性需求           | 需謹慎設計參數（ACK、ISR）才能保證一致性       | Pub/Sub 原生不保證一致性（Stream 較佳）     |
